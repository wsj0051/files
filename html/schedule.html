<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾ç¨‹è¡¨ ğŸ¦‹</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&family=Comic+Neue:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ä¸»é¢˜1: æ¨±èŠ±ç²‰ - é»˜è®¤ */
        :root,
        [data-theme="sakura"] {
            --primary-light: #FFE5F1;
            --primary-medium: #FFB6D9;
            --primary-dark: #FF69B4;
            --secondary-light: #E5D4FF;
            --secondary-medium: #C4A7E7;
            --accent: #B2F5EA;
            --text-dark: #5A3E5E;
            --text-light: #8B7A8E;
            --white: #FFFFFF;
            --shadow: 0 8px 32px rgba(255, 105, 180, 0.2);
            --shadow-hover: 0 12px 48px rgba(255, 105, 180, 0.3);
            --gradient-bg: linear-gradient(135deg, #FFE5F1 0%, #E5D4FF 50%, #B2F5EA 100%);
            --gradient-header: linear-gradient(135deg, #FF69B4 0%, #C4A7E7 50%, #FF69B4 100%);
            --gradient-btn: linear-gradient(135deg, #FF69B4 0%, #FF1493 100%);
        }

        /* ä¸»é¢˜2: æ¢¦å¹»ç´« */
        [data-theme="dream"] {
            --primary-light: #E8D5FF;
            --primary-medium: #C49BFF;
            --primary-dark: #9B59B6;
            --secondary-light: #F0E6FF;
            --secondary-medium: #D4A5FF;
            --accent: #FFD1DC;
            --text-dark: #4A3058;
            --text-light: #7A5A8E;
            --shadow: 0 8px 32px rgba(155, 89, 182, 0.2);
            --shadow-hover: 0 12px 48px rgba(155, 89, 182, 0.3);
            --gradient-bg: linear-gradient(135deg, #E8D5FF 0%, #F0E6FF 50%, #FFD1DC 100%);
            --gradient-header: linear-gradient(135deg, #9B59B6 0%, #D4A5FF 50%, #9B59B6 100%);
            --gradient-btn: linear-gradient(135deg, #9B59B6 0%, #8E44AD 100%);
        }

        /* ä¸»é¢˜3: å½©è™¹ç³– */
        [data-theme="rainbow"] {
            --primary-light: #FFE5E5;
            --primary-medium: #FFB3B3;
            --primary-dark: #FF6B6B;
            --secondary-light: #FFF5CC;
            --secondary-medium: #FFE066;
            --accent: #C5F0A4;
            --text-dark: #5A4040;
            --text-light: #8B6A6A;
            --shadow: 0 8px 32px rgba(255, 107, 107, 0.2);
            --shadow-hover: 0 12px 48px rgba(255, 107, 107, 0.3);
            --gradient-bg: linear-gradient(135deg, #FFE5E5 0%, #FFF5CC 25%, #C5F0A4 50%, #B3E5FC 75%, #E5D5FF 100%);
            --gradient-header: linear-gradient(135deg, #FF6B6B 0%, #FFE066 25%, #4ECDC4 50%, #45B7D1 75%, #96CEB4 100%);
            --gradient-btn: linear-gradient(135deg, #FF6B6B 0%, #FFE066 100%);
        }

        /* ä¸»é¢˜4: æ·±æµ·è“ */
        [data-theme="ocean"] {
            --primary-light: #E3F2FD;
            --primary-medium: #90CAF9;
            --primary-dark: #2196F3;
            --secondary-light: #E0F7FA;
            --secondary-medium: #4DD0E1;
            --accent: #B2EBF2;
            --text-dark: #1A3A5C;
            --text-light: #5A7A9A;
            --shadow: 0 8px 32px rgba(33, 150, 243, 0.2);
            --shadow-hover: 0 12px 48px rgba(33, 150, 243, 0.3);
            --gradient-bg: linear-gradient(135deg, #E3F2FD 0%, #E0F7FA 50%, #B2EBF2 100%);
            --gradient-header: linear-gradient(135deg, #2196F3 0%, #4DD0E1 50%, #2196F3 100%);
            --gradient-btn: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }

        /* ä¸»é¢˜5: æ£®æ—ç»¿ */
        [data-theme="forest"] {
            --primary-light: #E8F5E9;
            --primary-medium: #A5D6A7;
            --primary-dark: #4CAF50;
            --secondary-light: #F1F8E9;
            --secondary-medium: #AED581;
            --accent: #DCEDC8;
            --text-dark: #1B5E20;
            --text-light: #4A7A4E;
            --shadow: 0 8px 32px rgba(76, 175, 80, 0.2);
            --shadow-hover: 0 12px 48px rgba(76, 175, 80, 0.3);
            --gradient-bg: linear-gradient(135deg, #E8F5E9 0%, #F1F8E9 50%, #DCEDC8 100%);
            --gradient-header: linear-gradient(135deg, #4CAF50 0%, #AED581 50%, #4CAF50 100%);
            --gradient-btn: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
        }

        /* ä¸»é¢˜6: å¤ªç©ºç° */
        [data-theme="space"] {
            --primary-light: #ECEFF1;
            --primary-medium: #90A4AE;
            --primary-dark: #546E7A;
            --secondary-light: #F5F5F5;
            --secondary-medium: #BDBDBD;
            --accent: #B0BEC5;
            --text-dark: #263238;
            --text-light: #607D8B;
            --shadow: 0 8px 32px rgba(84, 110, 122, 0.2);
            --shadow-hover: 0 12px 48px rgba(84, 110, 122, 0.3);
            --gradient-bg: linear-gradient(135deg, #ECEFF1 0%, #F5F5F5 50%, #B0BEC5 100%);
            --gradient-header: linear-gradient(135deg, #546E7A 0%, #90A4AE 50%, #546E7A 100%);
            --gradient-btn: linear-gradient(135deg, #546E7A 0%, #37474F 100%);
        }

        /* å…¼å®¹æ—§å˜é‡å */
        :root {
            --pink-light: var(--primary-light);
            --pink-medium: var(--primary-medium);
            --pink-dark: var(--primary-dark);
            --purple-light: var(--secondary-light);
            --purple-medium: var(--secondary-medium);
            --lavender: #E6E6FA;
            --mint: var(--accent);
            --peach: #FFDAB9;
            --yellow-light: #FFF9C4;
        }

        body {
            font-family: 'Noto Sans SC', 'Comic Neue', sans-serif;
            background: var(--gradient-bg);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }

        /* å¯çˆ±è£…é¥°å…ƒç´  */
        .decoration {
            position: fixed;
            pointer-events: none;
            z-index: 0;
        }

        .butterfly {
            font-size: 2rem;
            animation: float 6s ease-in-out infinite;
        }

        .butterfly:nth-child(1) {
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        .butterfly:nth-child(2) {
            top: 20%;
            right: 8%;
            animation-delay: 1s;
        }

        .butterfly:nth-child(3) {
            bottom: 15%;
            left: 10%;
            animation-delay: 2s;
        }

        .butterfly:nth-child(4) {
            bottom: 25%;
            right: 5%;
            animation-delay: 3s;
        }

        .flower {
            font-size: 1.5rem;
            animation: spin 20s linear infinite;
        }

        .flower:nth-child(5) {
            top: 30%;
            left: 3%;
        }

        .flower:nth-child(6) {
            top: 60%;
            right: 4%;
        }

        .flower:nth-child(7) {
            bottom: 10%;
            left: 15%;
        }

        .star {
            font-size: 1.2rem;
            animation: twinkle 2s ease-in-out infinite;
        }

        .star:nth-child(8) {
            top: 15%;
            left: 20%;
            animation-delay: 0.5s;
        }

        .star:nth-child(9) {
            top: 50%;
            right: 15%;
            animation-delay: 1s;
        }

        .star:nth-child(10) {
            bottom: 20%;
            right: 20%;
            animation-delay: 1.5s;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(10deg);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 1rem;
            animation: fadeInDown 0.8s ease;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 229, 241, 0.9) 100%);
            padding: 1rem;
            border-radius: 30px;
            box-shadow: var(--shadow);
            border: 3px solid var(--pink-medium);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-header);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            font-family: 'Comic Neue', 'Noto Sans SC', sans-serif;
        }

        .owner-name {
            font-size: 1.3rem;
            color: var(--pink-dark);
            font-weight: 600;
            margin: 0.5rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: minmax(300px, 420px) 1fr;
            gap: 2rem;
            animation: fadeInUp 0.8s ease;
        }

        /* é…ç½®é¢æ¿ */
        .config-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 229, 241, 0.95) 100%);
            border: 3px solid var(--pink-medium);
            border-radius: 30px;
            padding: 2rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .config-panel:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .config-panel h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--pink-dark);
            font-family: 'Comic Neue', 'Noto Sans SC', sans-serif;
            text-align: center;
        }

        .course-manager {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .add-course-section {
            display: flex;
            gap: 0.5rem;
        }

        .add-course-section input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 2px solid var(--pink-medium);
            border-radius: 15px;
            font-size: 0.95rem;
            font-family: 'Noto Sans SC', sans-serif;
            outline: none;
            transition: all 0.3s ease;
        }

        .add-course-section input:focus {
            border-color: var(--pink-dark);
            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.2);
        }

        .btn-add {
            background: var(--gradient-btn);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 0 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 105, 180, 0.5);
        }

        .course-list-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            border: 2px dashed var(--pink-light);
        }

        .course-tag {
            background: white;
            padding: 0.5rem 0.8rem;
            border-radius: 12px;
            font-size: 0.9rem;
            color: var(--text-dark);
            border: 2px solid var(--pink-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            animation: fadeIn 0.3s ease;
        }

        .course-tag:hover {
            border-color: var(--pink-medium);
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .course-color-picker {
            width: 20px;
            height: 20px;
            border: none;
            cursor: pointer;
            background: transparent;
            padding: 0;
        }

        .course-delete-btn {
            width: 18px;
            height: 18px;
            background: var(--pink-light);
            color: var(--pink-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }

        .course-delete-btn:hover {
            background: var(--pink-dark);
            color: white;
            transform: scale(1.1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* æ¿€åŠ±è¯­è¾“å…¥ */
        .motivation-section {
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.6);
            padding: 1.5rem;
            border-radius: 20px;
            border: 2px dashed var(--mint);
        }

        .motivation-section h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--pink-dark);
            font-family: 'Comic Neue', 'Noto Sans SC', sans-serif;
            text-align: center;
        }

        .motivation-input {
            margin-bottom: 0;
        }

        .motivation-input label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .motivation-input textarea {
            width: 100%;
            padding: 0.9rem 1rem;
            background: white;
            border: 2px solid var(--mint);
            border-radius: 15px;
            color: var(--text-dark);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: 'Noto Sans SC', sans-serif;
            resize: vertical;
            min-height: 60px;
        }

        .motivation-input textarea:focus {
            outline: none;
            border-color: #4facfe;
            background: rgba(178, 245, 234, 0.2);
            box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.2);
            transform: scale(1.02);
        }

        .motivation-input textarea::placeholder {
            color: var(--text-light);
        }

        .motivation-controls {
            display: flex;
            gap: 0.5rem;
            align-items: flex-start;
        }

        .motivation-controls textarea {
            flex: 1;
        }

        .dice-btn {
            padding: 0.9rem 1rem;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border: 2px solid #FFB6D9;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.3);
            min-width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dice-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        }

        .dice-btn:active {
            animation: diceRoll 0.5s ease;
        }

        @keyframes diceRoll {
            0% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(90deg) scale(1.1);
            }

            50% {
                transform: rotate(180deg) scale(1.2);
            }

            75% {
                transform: rotate(270deg) scale(1.1);
            }

            100% {
                transform: rotate(360deg) scale(1);
            }
        }

        /* æŒ‰é’® */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .btn-save {
            background: var(--gradient-btn);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.4);
        }

        .btn-save:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(255, 105, 180, 0.6);
        }

        .btn-clear {
            background: linear-gradient(135deg, #C4A7E7 0%, #9370DB 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(196, 167, 231, 0.4);
        }

        .btn-clear:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(196, 167, 231, 0.6);
        }

        .btn-print {
            background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 182, 217, 0.4);
            padding: 1rem 2rem;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-print:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(255, 182, 217, 0.6);
        }

        /* é¢„è§ˆé¢æ¿ */
        .preview-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(229, 212, 255, 0.95) 100%);
            border: 3px solid var(--purple-medium);
            border-radius: 30px;
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .preview-header h2 {
            font-size: 1.5rem;
            color: var(--purple-medium);
            font-family: 'Comic Neue', 'Noto Sans SC', sans-serif;
            flex: 1;
        }

        .preview-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* è¯¾ç¨‹è¡¨æ ·å¼ */
        .schedule-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .schedule-table th,
        .schedule-table td {
            padding: 1rem;
            text-align: center;
            border: 2px solid var(--pink-light);
        }

        .schedule-table th {
            background: linear-gradient(135deg, var(--pink-medium) 0%, var(--purple-light) 100%);
            font-weight: 700;
            color: var(--text-dark);
            font-size: 1rem;
        }

        .schedule-table td {
            background: white;
            color: var(--text-dark);
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .schedule-table td:hover {
            background: var(--pink-light);
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(255, 105, 180, 0.2);
        }

        .schedule-table td.rest-cell {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-medium) 100%);
            color: var(--pink-dark);
            font-weight: 700;
        }

        .schedule-table td.course-cell {
            color: var(--text-dark);
            font-weight: 600;
        }

        .schedule-table td.empty-cell {
            color: var(--text-light);
            font-style: italic;
        }

        /* æ‰“å°æ ·å¼ */
        .print-only {
            display: none;
        }

        @media print {
            body {
                background: white;
                color: black;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .container {
                display: none;
            }

            .decoration {
                display: none;
            }

            .print-only {
                display: block;
            }

            .print-header {
                display: none;
            }

            .print-footer {
                display: none;
            }

            .schedule-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 0;
                page-break-inside: avoid;
            }

            .schedule-table th,
            .schedule-table td {
                border: 2px solid #FFB6D9;
                padding: 8px 4px;
                text-align: center;
                font-size: 10pt;
            }

            .schedule-table th {
                background: #FFE5F1 !important;
                font-weight: bold;
                font-size: 11pt;
                color: #5A3E5E !important;
            }

            .schedule-table td {
                font-size: 10pt;
                min-height: 30px;
                color: #5A3E5E !important;
            }

            .schedule-table td.rest-cell {
                background: #FFE5F1 !important;
                color: #FF69B4 !important;
                font-weight: bold;
            }

            .schedule-table td.course-cell {
                color: #5A3E5E !important;
                font-weight: 600;
            }

            @page {
                size: A4 landscape;
                margin: 10mm;
            }
        }

        /* è¯¾ç¨‹é€‰æ‹©å¼¹çª— */
        .course-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .course-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .course-modal {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 229, 241, 0.98) 100%);
            border: 3px solid var(--pink-medium);
            border-radius: 30px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.4);
            transform: scale(0.8) translateY(-20px);
            transition: all 0.3s ease;
        }

        .course-modal-overlay.active .course-modal {
            transform: scale(1) translateY(0);
        }

        .course-modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px dashed var(--pink-medium);
        }

        .course-modal-header h3 {
            font-size: 1.4rem;
            color: var(--pink-dark);
            font-family: 'Comic Neue', 'Noto Sans SC', sans-serif;
            margin-bottom: 0.5rem;
        }

        .course-modal-header p {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .course-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        .course-option {
            padding: 0.8rem 0.5rem;
            background: white;
            border: 2px solid var(--pink-light);
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-dark);
            transition: all 0.3s ease;
            text-align: center;
        }

        .course-option:hover {
            background: var(--pink-light);
            border-color: var(--pink-dark);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.3);
        }

        .course-option.rest-option {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-medium) 100%);
            border-color: var(--pink-medium);
        }

        .course-option.rest-option:hover {
            background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .course-modal-custom {
            margin-bottom: 1.5rem;
        }

        .course-modal-custom label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .course-modal-custom input {
            width: 100%;
            padding: 0.9rem 1rem;
            background: white;
            border: 2px solid var(--pink-medium);
            border-radius: 15px;
            color: var(--text-dark);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: 'Noto Sans SC', sans-serif;
        }

        .course-modal-custom input:focus {
            outline: none;
            border-color: var(--pink-dark);
            box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.2);
        }

        .course-modal-buttons {
            display: flex;
            gap: 1rem;
        }

        .course-modal-buttons .btn {
            flex: 1;
        }

        .btn-confirm {
            background: var(--gradient-btn);
            color: white;
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.4);
        }

        .btn-confirm:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(255, 105, 180, 0.6);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #C4A7E7 0%, #9370DB 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(196, 167, 231, 0.4);
        }

        .btn-cancel:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(196, 167, 231, 0.6);
        }

        .btn-clear-cell {
            background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 182, 217, 0.4);
        }

        .btn-clear-cell:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 182, 217, 0.6);
        }

        /* å¯ç‚¹å‡»çš„å•å…ƒæ ¼æ ·å¼ */
        .schedule-table td.clickable-cell {
            cursor: pointer;
            position: relative;
        }

        .schedule-table td.clickable-cell::after {
            content: 'âœï¸';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .schedule-table td.clickable-cell:hover::after {
            opacity: 0.6;
        }

        .schedule-table td.clickable-cell:hover {
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary-light) 100%) !important;
            transform: scale(1.08);
            box-shadow: var(--shadow);
            z-index: 1;
        }

        /* åŠ¨ç”» */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .config-panel {
                max-width: 600px;
                margin: 0 auto;
            }
        }

        /* ç¡®è®¤å¼¹çª—é®ç½© */
        .confirm-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .confirm-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        @media print {
            .period-controls {
                display: none !important;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .preview-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .butterfly,
            .flower,
            .star {
                font-size: 1rem;
            }
        }

        /* é€šçŸ¥åŠ¨ç”» */
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* ä¸»é¢˜é€‰æ‹©å™¨æ ·å¼ */
        .theme-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }

        .theme-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
        }

        .theme-btn.active {
            border-color: var(--primary-dark);
            transform: scale(1.15);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .theme-btn[data-theme="sakura"] {
            background: linear-gradient(135deg, #FFB6D9, #FF69B4);
        }

        .theme-btn[data-theme="dream"] {
            background: linear-gradient(135deg, #C49BFF, #9B59B6);
        }

        .theme-btn[data-theme="rainbow"] {
            background: linear-gradient(135deg, #FF6B6B, #FFE066, #4ECDC4);
        }

        .theme-btn[data-theme="ocean"] {
            background: linear-gradient(135deg, #90CAF9, #2196F3);
        }

        .theme-btn[data-theme="forest"] {
            background: linear-gradient(135deg, #A5D6A7, #4CAF50);
        }

        .theme-btn[data-theme="space"] {
            background: linear-gradient(135deg, #90A4AE, #546E7A);
        }

        /* åå­—å¯ç¼–è¾‘æ ·å¼ */
        .owner-name {
            cursor: pointer;
            position: relative;
        }

        .owner-name:hover {
            opacity: 0.8;
        }

        .owner-name .edit-icon {
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .owner-name:hover .edit-icon {
            opacity: 1;
        }

        .name-input-container {
            display: none;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .name-input-container.active {
            display: flex;
            justify-content: center;
        }

        .name-input {
            padding: 0.5rem 1rem;
            border: 2px solid var(--primary-medium);
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-dark);
            background: white;
            text-align: center;
            width: 150px;
        }

        .name-input:focus {
            outline: none;
            border-color: var(--primary-dark);
            box-shadow: 0 0 0 3px rgba(255, 105, 180, 0.2);
        }

        .name-confirm-btn {
            padding: 0.5rem 1rem;
            background: var(--gradient-btn);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .name-confirm-btn:hover {
            transform: scale(1.05);
        }

        /* æ—¶é—´ç¼–è¾‘å¼¹çª— */
        .time-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .time-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .time-modal {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 229, 241, 0.98) 100%);
            border: 3px solid var(--primary-medium);
            border-radius: 25px;
            padding: 1.5rem;
            max-width: 350px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(255, 105, 180, 0.4);
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .time-modal-overlay.active .time-modal {
            transform: scale(1);
        }

        .time-modal h3 {
            text-align: center;
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .time-inputs {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .time-inputs input {
            
            padding: 0.6rem;
            border: 2px solid var(--primary-medium);
            border-radius: 10px;
            font-size: 1rem;
            text-align: center;
        }

        .time-inputs input:focus {
            outline: none;
            border-color: var(--primary-dark);
        }

        .time-inputs span {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-dark);
        }

        .time-modal-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .time-modal-buttons .btn {
            flex: 1;
            padding: 0.7rem;
            font-size: 0.9rem;
        }

        /* æ—¶é—´å•å…ƒæ ¼æ ·å¼ */
        .schedule-table td.time-cell {
            cursor: pointer;
            position: relative;
        }

        .schedule-table td.time-cell:hover {
            background: var(--primary-light) !important;
            transform: scale(1.02);
        }

        .schedule-table td.time-cell .time-display {
            font-size: 0.75rem;
            color: var(--text-light);
            display: block;
            margin-top: 2px;
        }

        .schedule-table td.time-cell::after {
            content: 'â°';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.6rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .schedule-table td.time-cell:hover::after {
            opacity: 0.6;
        }

        /* å‘¨æœ«æ§åˆ¶ */
        .weekend-controls {
            display: flex;
            gap: 0.5rem;
        }

        /* å¼€å…³æ ·å¼ */
        .switch {
            display: flex;
            align-items: center;
            width: auto;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: relative;
            cursor: pointer;
            width: 50px;
            height: 24px;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-dark);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .switch-label {
            margin-left: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .weekend-switches {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .print-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
    </style>
</head>

<body>
    <!-- å¯çˆ±è£…é¥°å…ƒç´  -->
    <div class="decoration butterfly">ğŸ¦‹</div>
    <div class="decoration butterfly">ğŸ¦‹</div>
    <div class="decoration butterfly">ğŸ¦‹</div>
    <div class="decoration butterfly">ğŸ¦‹</div>
    <div class="decoration flower">ğŸŒ¸</div>
    <div class="decoration flower">ğŸŒº</div>
    <div class="decoration flower">ğŸŒ¼</div>
    <div class="decoration star">â­</div>
    <div class="decoration star">âœ¨</div>
    <div class="decoration star">ğŸ’«</div>

    <div class="container">
        <header class="header">
            <h1>ğŸŒˆ æˆ‘çš„è¯¾ç¨‹è¡¨ ğŸŒˆ</h1>
            <div class="owner-name" id="ownerNameDisplay" onclick="showNameEdit()">
                <span id="ownerIcon">ğŸ‘§</span>
                <span id="ownerNameText"></span>
                <span id="ownerDecor">ğŸ€</span>
                <span class="edit-icon">âœï¸</span>
            </div>
            <div class="name-input-container" id="nameInputContainer">
                <input type="text" class="name-input" id="nameInput" placeholder="è¾“å…¥åå­—" maxlength="10">
                <button class="name-confirm-btn" onclick="confirmNameEdit()">ç¡®å®š</button>
            </div>
            <p class="subtitle">è®©å­¦ä¹ å˜å¾—æ›´æœ‰è¶£ âœ¨</p>
            <div class="theme-selector">
                <button class="theme-btn active" data-theme="sakura" title="ğŸŒ¸ æ¨±èŠ±ç²‰">ğŸŒ¸</button>
                <button class="theme-btn" data-theme="dream" title="ğŸ’œ æ¢¦å¹»ç´«">ğŸŒ™</button>
                <button class="theme-btn" data-theme="rainbow" title="ğŸŒˆ å½©è™¹ç³–">ğŸ­</button>
                <button class="theme-btn" data-theme="ocean" title="ğŸŒŠ æ·±æµ·è“">ğŸ¬</button>
                <button class="theme-btn" data-theme="forest" title="ğŸŒ² æ£®æ—ç»¿">ğŸŒ²</button>
                <button class="theme-btn" data-theme="space" title="ğŸš€ å¤ªç©ºç°">ğŸš€</button>
            </div>
        </header>

        <div class="main-content">
            <!-- é…ç½®é¢æ¿ -->
            <div class="config-panel">
                <h2>ğŸ“ è¯¾ç¨‹é…ç½® ğŸ¨</h2>
                <div class="course-manager">
                    <p class="subtitle" style="text-align:center; margin-bottom: 1rem;">â¬‡ï¸ åœ¨è¿™é‡Œæ·»åŠ è¯¾ç¨‹ï¼Œç‚¹å‡»è¯¾ç¨‹è¡¨å³å¯é€‰æ‹©å“¦</p>
                    <div class="add-course-section">
                        <input type="text" id="newCourseInput" placeholder="è¾“å…¥æ–°è¯¾ç¨‹åç§°..." maxlength="10">
                        <button class="btn-add" id="addCourseBtn">â• æ·»åŠ </button>
                    </div>
                    <div class="course-list-container" id="courseListManager">
                        <!-- è¯¾ç¨‹æ ‡ç­¾åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                <div class="action-buttons" style="margin-top: 1rem;">
                    <button class="btn btn-save" id="exportBtn">ğŸ“¤ å¯¼å‡ºå¤‡ä»½</button>
                    <label class="btn btn-clear" for="importFile" style="cursor: pointer;">ğŸ“¥ å¯¼å…¥å¤‡ä»½</label>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>
            </div>

            <!-- é¢„è§ˆé¢æ¿ -->
            <div class="preview-panel">
                <div class="preview-header">
                    <h2>ğŸ‘€ è¯¾ç¨‹è¡¨é¢„è§ˆ ğŸŒŸ</h2>
                    <div class="print-controls">
                        <button class="btn btn-print" id="printBtn">ğŸ–¨ï¸ æ‰“å°</button>
                        <div class="weekend-switches">
                            <label class="switch">
                                <input type="checkbox" id="showSaturday">
                                <span class="slider"></span>
                                <span class="switch-label">å‘¨å…­</span>
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="showSunday">
                                <span class="slider"></span>
                                <span class="switch-label">å‘¨æ—¥</span>
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="equalWidth">
                                <span class="slider"></span>
                                <span class="switch-label">ç­‰å®½</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="schedule-container" id="schedulePreview">
                    <!-- è¯¾ç¨‹è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="motivation-section">

                    <div class="motivation-input">
                        <div class="motivation-controls">
                            <textarea id="motivationText" placeholder="è¾“å…¥ä½ çš„æ¿€åŠ±è¯­...">å­¦ä¹ å¾ˆè‹¦,åšæŒå¾ˆé…·</textarea>
                            <button class="dice-btn" id="diceBtn" title="éšæœºæ¢ä¸€æ¡æ¿€åŠ±è¯­">ğŸ²</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- è¯¾ç¨‹é€‰é¡¹åˆ—è¡¨ -->
    <datalist id="courseList">
        <option value="è¯­æ–‡">
        <option value="æ•°å­¦">
        <option value="è‹±è¯­">
        <option value="é“å¾·ä¸æ³•æ²»">
        <option value="å†å²">
        <option value="åœ°ç†">
        <option value="ç‰©ç†">
        <option value="åŒ–å­¦">
        <option value="ç”Ÿç‰©">
        <option value="ä½“è‚²ä¸å¥åº·">
        <option value="éŸ³ä¹">
        <option value="ç¾æœ¯">
        <option value="ä¿¡æ¯æŠ€æœ¯">
        <option value="åŠ³åŠ¨/ç»¼åˆå®è·µæ´»åŠ¨">
        <option value="è®¡ç®—æœº">
        <option value="èµ·åºŠ">
        <option value="æ—©è‡ªä¹ ">
        <option value="æ™šè‡ªä¹ ">
        <option value="æ™šè‡ªä¹ "></option>
        <option value="ğŸ˜´ ä¼‘æ¯"></option>
    </datalist>

    <!-- æ‰“å°ä¸“ç”¨åŒºåŸŸ -->
    <div class="print-only">
        <div id="printSchedule"></div>
    </div>
    <!-- è¯¾ç¨‹é€‰æ‹©å¼¹çª— -->
    <div class="course-modal-overlay" id="courseModalOverlay">
        <div class="course-modal">
            <div class="course-modal-header">
                <h3>ğŸ“š é€‰æ‹©è¯¾ç¨‹ âœ¨</h3>
                <p id="modalCellInfo">å‘¨ä¸€ ç¬¬1èŠ‚</p>
            </div>
            <div class="course-options" id="courseOptions">
                <!-- è¯¾ç¨‹é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="course-modal-custom">
                <label>âœï¸ æˆ–è€…è¾“å…¥è‡ªå®šä¹‰è¯¾ç¨‹ï¼š</label>
                <input type="text" id="customCourseInput" placeholder="è¾“å…¥è¯¾ç¨‹åç§°...">
            </div>
            <div class="course-modal-buttons">
                <button class="btn btn-confirm" id="confirmCourseBtn">ğŸ’¾ ç¡®å®š</button>
                <button class="btn btn-clear-cell" id="clearCellBtn">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button class="btn btn-cancel" id="cancelCourseBtn">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- æ—¶é—´ç¼–è¾‘å¼¹çª— -->
    <div class="time-modal-overlay" id="timeModalOverlay">
        <div class="time-modal">
            <h3>â° è®¾ç½®ä¸Šè¯¾æ—¶é—´</h3>
            <p id="timePeriodInfo" style="text-align:center; color: var(--text-light); margin-bottom: 1rem;">ç¬¬1èŠ‚</p>
            <div style="margin-bottom: 1rem;">
                <label for="periodNameInput" style="display: block; margin-bottom: 0.5rem; color: var(--text-dark); font-size: 0.9rem; font-weight: 600;">âœï¸ èŠ‚æ¬¡åç§°ï¼š</label>
                <input type="text" id="periodNameInput" placeholder="è¾“å…¥èŠ‚æ¬¡åç§°ï¼ˆå¦‚ï¼šæ—©è¯»ï¼‰" maxlength="10" style="width: 100%; padding: 0.6rem; border: 2px solid var(--primary-medium); border-radius: 10px; font-size: 1rem; text-align: center;">
            </div>
            <div class="time-inputs">
                <input type="time" id="timeStart" value="08:00">
                <span>â€”</span>
                <input type="time" id="timeEnd" value="08:45">
            </div>
            <div class="time-modal-buttons">
                <button class="btn btn-confirm" id="confirmTimeBtn">ğŸ’¾ ç¡®å®š</button>
                <button class="btn btn-clear-cell" id="clearTimeBtn">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button class="btn btn-cancel" id="cancelTimeBtn">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>


    <!-- ç¡®è®¤åˆ é™¤å¼¹çª— -->
    <div class="confirm-modal-overlay" id="confirmModalOverlay">
        <div class="course-modal" style="width: 320px;">
            <div class="course-modal-header">
                <h3>âš ï¸ ç¡®è®¤åˆ é™¤</h3>
            </div>
            <div style="padding: 1.5rem; text-align: center; font-size: 1.1rem; color: var(--text-dark);">
                <p id="confirmMessage">ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ</p>
            </div>
            <div class="course-modal-buttons">
                <button class="btn btn-confirm" id="confirmYesBtn">âœ”ï¸ ç¡®å®š</button>
                <button class="btn btn-cancel" id="confirmNoBtn">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // è¯¾ç¨‹æ•°æ®ç»“æ„ - æ¯å¤©çš„è¯¾ç¨‹æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ”¯æŒåŠ¨æ€å¢å‡
        const scheduleData = {
            monday: { courses: ['', '', '', '', '', '', '', ''] },
            tuesday: { courses: ['', '', '', '', '', '', '', ''] },
            wednesday: { courses: ['', '', '', '', '', '', '', ''] },
            thursday: { courses: ['', '', '', '', '', '', '', ''] },
            friday: { courses: ['', '', '', '', '', '', '', ''] },
            saturday: { courses: ['', '', '', '', '', '', '', ''] },
            sunday: { courses: ['', '', '', '', '', '', '', ''] }
        };

        // å½“å‰é€‰ä¸­çš„æ—¥æœŸ
        let currentDay = 'monday';

        // é»˜è®¤è¯¾ç¨‹åˆ—è¡¨
        const defaultCourseList = [
            {name: 'è¯­æ–‡', color: '#FFE5F1'},
            {name: 'æ•°å­¦', color: '#E5D4FF'},
            {name: 'è‹±è¯­', color: '#B2F5EA'},
            {name: 'é“å¾·ä¸æ³•æ²»', color: '#FFDAB9'},
            {name: 'å†å²', color: '#FFF9C4'},
            {name: 'åœ°ç†', color: '#E8D5FF'},
            {name: 'ç‰©ç†', color: '#C4A7E7'},
            {name: 'åŒ–å­¦', color: '#90CAF9'},
            {name: 'ç”Ÿç‰©', color: '#A5D6A7'},
            {name: 'ä½“è‚²ä¸å¥åº·', color: '#E0F7FA'},
            {name: 'éŸ³ä¹', color: '#F1F8E9'},
            {name: 'ç¾æœ¯', color: '#ECEFF1'},
            {name: 'ä¿¡æ¯æŠ€æœ¯', color: '#FFE5E5'},
            {name: 'åŠ³åŠ¨/ç»¼åˆå®è·µæ´»åŠ¨', color: '#FFF5CC'},
            {name: 'è®¡ç®—æœº', color: '#C5F0A4'},
            {name: 'æ™šè‡ªä¹ ', color: '#E5D5FF'}
        ];

        // åŠ¨æ€è¯¾ç¨‹åˆ—è¡¨
        let courseList = [...defaultCourseList];

        // æ¿€åŠ±è¯­
        let motivationText = 'å­¦ä¹ å¾ˆè‹¦,åšæŒå¾ˆé…·';

        // ç”¨æˆ·åå­—
        let ownerName = 'éŸ©ä¸½è';

        // å½“å‰ä¸»é¢˜
        let currentTheme = 'sakura';

        // è¯¾ç¨‹èŠ‚æ•°ï¼ˆé»˜è®¤8èŠ‚ï¼‰
        let periodCount = 8;

        // è¯¾ç¨‹æ—¶é—´ (åŠ¨æ€æ•°ç»„)
        let periodTimes = [];
        for (let i = 0; i < 15; i++) {
            periodTimes.push({ start: '', end: '' });
        }

        // èŠ‚æ¬¡åç§° (åŠ¨æ€æ•°ç»„ï¼Œé»˜è®¤â€œç¬¬XèŠ‚â€)
        let periodNames = [];
        for (let i = 0; i < 15; i++) {
            periodNames.push(`ç¬¬${i + 1}èŠ‚`);
        }

        // å½“å‰ç¼–è¾‘çš„æ—¶é—´ç´¢å¼•
        let currentTimeIndex = -1;

        // æ˜¾ç¤ºçš„æ—¥å­
        let shownDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];

        // æ—¥å­é¡ºåº
        const dayOrder = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

        // ä¸»é¢˜è£…é¥°å…ƒç´ é…ç½®
        const themeDecorations = {
            sakura: {
                items: ['ğŸ¦‹', 'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ¼', 'â­', 'âœ¨', 'ğŸ’«', 'ğŸ€', 'ğŸ’–', 'ğŸŒ·'],
                icon: 'ğŸ‘§',
                decor: 'ğŸ€',
                printLeft: 'ğŸ¦‹ğŸŒ¸',
                printRight: 'ğŸŒºğŸ¦‹'
            },
            dream: {
                items: ['ğŸŒ™', 'â­', 'âœ¨', 'ğŸ’«', 'ğŸ”®', 'ğŸ’œ', 'ğŸ¦„', 'â˜ï¸', 'ğŸŒŸ', 'ğŸ’'],
                icon: 'ğŸ‘¸',
                decor: 'ğŸ’œ',
                printLeft: 'ğŸŒ™âœ¨',
                printRight: 'â­ğŸ”®'
            },
            rainbow: {
                items: ['ğŸŒˆ', 'ğŸ­', 'ğŸ¬', 'ğŸˆ', 'ğŸ€', 'ğŸ’•', 'ğŸ¦‹', 'ğŸŒº', 'ğŸ©', 'ğŸ§'],
                icon: 'ğŸ‘§',
                decor: 'ğŸŒˆ',
                printLeft: 'ğŸŒˆğŸ­',
                printRight: 'ğŸ¬ğŸŒˆ'
            },
            ocean: {
                items: ['ğŸ¬', 'ğŸŒŠ', 'ğŸ³', 'ğŸ ', 'ğŸ¦ˆ', 'âš“', 'ğŸš', 'ğŸ¦€', 'ğŸŒ´', 'â›µ'],
                icon: 'ğŸ‘¦',
                decor: 'ğŸ¬',
                printLeft: 'ğŸ¬ğŸŒŠ',
                printRight: 'ğŸ³ğŸŒŠ'
            },
            forest: {
                items: ['ğŸŒ²', 'ğŸŒ³', 'ğŸ€', 'ğŸŒ¿', 'ğŸ¦Š', 'ğŸ¿ï¸', 'ğŸ„', 'ğŸ¦Œ', 'ğŸŒ»', 'ğŸ¦'],
                icon: 'ğŸ‘¦',
                decor: 'ğŸŒ²',
                printLeft: 'ğŸŒ²ğŸ€',
                printRight: 'ğŸŒ¿ğŸŒ³'
            },
            space: {
                items: ['ğŸš€', 'ğŸŒŸ', 'ğŸª', 'ğŸ‘¨â€ğŸš€', 'ğŸ›¸', 'â˜„ï¸', 'ğŸŒŒ', 'ğŸ”­', 'â­', 'ğŸŒ™'],
                icon: 'ğŸ‘¦',
                decor: 'ğŸš€',
                printLeft: 'ğŸš€ğŸŒŸ',
                printRight: 'ğŸªğŸ›¸'
            }
        };


        // 100æ¡æ¿€åŠ±è¯æœ¯
        const motivationQuotes = [
            'å­¦ä¹ å¾ˆè‹¦,åšæŒå¾ˆé…·',
            'æ¯ä¸€æ¬¡åŠªåŠ›ï¼Œéƒ½æ˜¯æˆé•¿çš„é˜¶æ¢¯',
            'ä»Šå¤©çš„åŠªåŠ›ï¼Œæ˜¯æ˜å¤©çš„éª„å‚²',
            'ç›¸ä¿¡è‡ªå·±ï¼Œä½ å¯ä»¥åšåˆ°',
            'æ¢¦æƒ³åœ¨å‰æ–¹ï¼ŒåŠªåŠ›åœ¨è·¯ä¸Š',
            'å°å°çš„è¿›æ­¥ï¼Œä¹Ÿæ˜¯å¤§å¤§çš„æˆåŠŸ',
            'åšæœ€å¥½çš„è‡ªå·±ï¼Œä¸è´Ÿé’æ˜¥æ—¶å…‰',
            'å‹‡æ•¢è¿½æ¢¦ï¼Œæ°¸ä¸æ”¾å¼ƒ',
            'æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œå°±æ˜¯æœ€æ£’çš„è‡ªå·±',
            'ç”¨å¾®ç¬‘é¢å¯¹æŒ‘æˆ˜ï¼Œç”¨åŠªåŠ›åˆ›é€ å¥‡è¿¹',
            'ä½ æ¯”æƒ³è±¡ä¸­æ›´ä¼˜ç§€',
            'åšæŒä¸‹å»ï¼Œç¾å¥½æ­£åœ¨è·¯ä¸Š',
            'å­¦ä¹ æ˜¯ç»™è‡ªå·±æœ€å¥½çš„ç¤¼ç‰©',
            'ä»Šå¤©çš„æ±—æ°´ï¼Œæ˜¯æ˜å¤©çš„å½©è™¹',
            'ç›¸ä¿¡åŠªåŠ›çš„åŠ›é‡',
            'æ¯ä¸€ä¸ªå›°éš¾ï¼Œéƒ½æ˜¯æˆé•¿çš„æœºä¼š',
            'åšä¸€ä¸ªæ¸©æš–åˆåŠªåŠ›çš„å¥³å­©',
            'çŸ¥è¯†æ˜¯æœ€ç¾çš„è£…é¥°',
            'ç”¨å¿ƒå­¦ä¹ ï¼Œå¿«ä¹æˆé•¿',
            'ä½ çš„åŠªåŠ›ï¼Œæ—¶å…‰ä¼šè®°å¾—',
            'ä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·',
            'åšè‡ªå·±çš„å°å¤ªé˜³',
            'åŠªåŠ›åˆ°æ— èƒ½ä¸ºåŠ›ï¼Œæ‹¼æåˆ°æ„ŸåŠ¨è‡ªå·±',
            'æ˜Ÿå…‰ä¸é—®èµ¶è·¯äºº',
            'æ¸©æŸ”ä¸”åšå®šåœ°å‰è¡Œ',
            'æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„å¼€å§‹',
            'ç”¨çŸ¥è¯†ç‚¹äº®æœªæ¥',
            'åšä¸€ä¸ªé—ªé—ªå‘å…‰çš„å¥³å­©',
            'è¶ŠåŠªåŠ›ï¼Œè¶Šå¹¸è¿',
            'ä¹¦å±±æœ‰è·¯å‹¤ä¸ºå¾„',
            'å­¦æµ·æ— æ¶¯è‹¦ä½œèˆŸ',
            'å¤©é“é…¬å‹¤ï¼Œåšç§¯è–„å‘',
            'å®å‰‘é”‹ä»ç£¨ç ºå‡º',
            'æ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥',
            'å°‘å¹´æ˜“å­¦è€éš¾æˆ',
            'ä¸€å¯¸å…‰é˜´ä¸å¯è½»',
            'é»‘å‘ä¸çŸ¥å‹¤å­¦æ—©',
            'ç™½é¦–æ–¹æ‚”è¯»ä¹¦è¿Ÿ',
            'è¯»ä¹¦ç ´ä¸‡å·ï¼Œä¸‹ç¬”å¦‚æœ‰ç¥',
            'ä¹¦ç±æ˜¯äººç±»è¿›æ­¥çš„é˜¶æ¢¯',
            'çŸ¥è¯†æ”¹å˜å‘½è¿',
            'å­¦ä¹ æˆå°±æœªæ¥',
            'ä»Šæ—¥äº‹ï¼Œä»Šæ—¥æ¯•',
            'æ˜æ—¥å¤æ˜æ—¥ï¼Œæ˜æ—¥ä½•å…¶å¤š',
            'æˆ‘ç”Ÿå¾…æ˜æ—¥ï¼Œä¸‡äº‹æˆè¹‰è·',
            'å°‘å£®ä¸åŠªåŠ›ï¼Œè€å¤§å¾’ä¼¤æ‚²',
            'ä¸€åˆ†è€•è€˜ï¼Œä¸€åˆ†æ”¶è·',
            'ä¸ç»ä¸€ç•ªå¯’å½»éª¨ï¼Œæ€å¾—æ¢…èŠ±æ‰‘é¼»é¦™',
            'æœ‰å¿—è€…äº‹ç«Ÿæˆ',
            'ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªæ€•æœ‰å¿ƒäºº',
            'åªè¦åŠŸå¤«æ·±ï¼Œé“æµç£¨æˆé’ˆ',
            'åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹',
            'ä¸ç§¯è·¬æ­¥ï¼Œæ— ä»¥è‡³åƒé‡Œ',
            'ä¸ç§¯å°æµï¼Œæ— ä»¥æˆæ±Ÿæµ·',
            'é”²è€Œä¸èˆï¼Œé‡‘çŸ³å¯é•‚',
            'ç»³é”¯æœ¨æ–­ï¼Œæ°´æ»´çŸ³ç©¿',
            'ä¸šç²¾äºå‹¤ï¼Œè’äºå¬‰',
            'è¡Œæˆäºæ€ï¼Œæ¯äºéš',
            'ä¹¦è¯»ç™¾éï¼Œå…¶ä¹‰è‡ªè§',
            'æ¸©æ•…è€ŒçŸ¥æ–°',
            'å­¦è€Œä¸æ€åˆ™ç½”',
            'æ€è€Œä¸å­¦åˆ™æ®†',
            'çŸ¥ä¹‹ä¸ºçŸ¥ä¹‹ï¼Œä¸çŸ¥ä¸ºä¸çŸ¥',
            'ä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸ˆç„‰',
            'æ•è€Œå¥½å­¦ï¼Œä¸è€»ä¸‹é—®',
            'å­¦æ— æ­¢å¢ƒ',
            'æ´»åˆ°è€ï¼Œå­¦åˆ°è€',
            'ç¬¨é¸Ÿå…ˆé£æ—©å…¥æ—',
            'å‹¤èƒ½è¡¥æ‹™æ˜¯è‰¯è®­',
            'ä¸€ä»½è¾›è‹¦ä¸€ä»½æ‰',
            'å¤©æ‰æ˜¯ç™¾åˆ†ä¹‹ä¸€çš„çµæ„ŸåŠ ç™¾åˆ†ä¹‹ä¹åä¹çš„æ±—æ°´',
            'æˆåŠŸçš„ç§˜è¯€åœ¨äºåšæŒ',
            'å¤±è´¥æ˜¯æˆåŠŸä¹‹æ¯',
            'ä»å“ªé‡Œè·Œå€’å°±ä»å“ªé‡Œçˆ¬èµ·æ¥',
            'å›°éš¾åƒå¼¹ç°§ï¼Œä½ å¼±å®ƒå°±å¼º',
            'è‡ªä¿¡æ˜¯æˆåŠŸçš„ç¬¬ä¸€ç§˜è¯€',
            'æ€åº¦å†³å®šä¸€åˆ‡',
            'ç»†èŠ‚å†³å®šæˆè´¥',
            'æœºä¼šæ€»æ˜¯ç•™ç»™æœ‰å‡†å¤‡çš„äºº',
            'ä»Šå¤©çš„ä½ ï¼Œæ¯”æ˜¨å¤©æ›´ä¼˜ç§€',
            'æ¯ä¸€æ¬¡å°è¯•ï¼Œéƒ½æ˜¯ä¸€æ¬¡æˆé•¿',
            'å‹‡æ•¢åšè‡ªå·±ï¼Œä¸–ç•Œä¼šä¸ºä½ è®©è·¯',
            'ç”¨åŠªåŠ›ä¹¦å†™ç²¾å½©äººç”Ÿ',
            'åšä¸€ä¸ªæœ‰æ¢¦æƒ³çš„è¿½æ¢¦äºº',
            'è®©ä¼˜ç§€æˆä¸ºä¸€ç§ä¹ æƒ¯',
            'ç”¨è¡ŒåŠ¨è¯æ˜è‡ªå·±',
            'ä¸æ€•æ…¢ï¼Œå°±æ€•ç«™',
            'ä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œè¸å®å‰è¡Œ',
            'å¿ƒæœ‰å¤šå¤§ï¼Œèˆå°å°±æœ‰å¤šå¤§',
            'ä½ çš„æ½œåŠ›æ— é™',
            'åšæœ€æ£’çš„è‡ªå·±',
            'ç”¨æ™ºæ…§ç‚¹äº®äººç”Ÿ',
            'å­¦ä¹ ä½¿æˆ‘å¿«ä¹',
            'çŸ¥è¯†å°±æ˜¯åŠ›é‡',
            'è¯»ä¹¦ä½¿äººæ˜æ™º',
            'è…¹æœ‰è¯—ä¹¦æ°”è‡ªå',
            'ä¹¦é¦™ä¼´æˆ‘æˆé•¿',
            'åœ¨ä¹¦ä¸­é‡è§æ›´å¥½çš„è‡ªå·±',
            'æ¯ä¸€æœ¬ä¹¦éƒ½æ˜¯ä¸€ä¸ªæ–°ä¸–ç•Œ',
            'é˜…è¯»è®©ç”Ÿæ´»æ›´ç¾å¥½'
        ];

        // æ˜ŸæœŸæ˜ å°„
        const dayMap = {
            monday: 'å‘¨ä¸€',
            tuesday: 'å‘¨äºŒ',
            wednesday: 'å‘¨ä¸‰',
            thursday: 'å‘¨å››',
            friday: 'å‘¨äº”',
            saturday: 'å‘¨å…­',
            sunday: 'å‘¨æ—¥'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadFromLocalStorage();
            initEventListeners();
            initModalEvents();
            initThemeEvents();
            initTimeModalEvents();
            applyTheme(currentTheme);
            updateOwnerNameDisplay();
            renderSchedule();
            renderCourseManager();
            updateWeekendSwitches();
        });

        function updateWeekendSwitches() {
            document.getElementById('showSaturday').checked = shownDays.includes('saturday');
            document.getElementById('showSunday').checked = shownDays.includes('sunday');
            document.getElementById('equalWidth').checked = false; // é»˜è®¤ä¸ç­‰å®½
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // æ·»åŠ è¯¾ç¨‹æŒ‰é’®
            document.getElementById('addCourseBtn').addEventListener('click', () => {
                const input = document.getElementById('newCourseInput');
                const courseName = input.value.trim();
                if (courseName) {
                    addCourse(courseName);
                    input.value = '';
                }
            });

            // æ·»åŠ è¯¾ç¨‹å›è½¦äº‹ä»¶
            document.getElementById('newCourseInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const courseName = e.target.value.trim();
                    if (courseName) {
                        addCourse(courseName);
                        e.target.value = '';
                    }
                }
            });



            // æ‰“å°æŒ‰é’®
            document.getElementById('printBtn').addEventListener('click', printSchedule);

            // æ¿€åŠ±è¯­è¾“å…¥
            document.getElementById('motivationText').addEventListener('input', (e) => {
                motivationText = e.target.value.trim();
                saveToLocalStorage();
            });

            // éª°å­æŒ‰é’® - éšæœºæ¢æ¿€åŠ±è¯­
            document.getElementById('diceBtn').addEventListener('click', () => {
                // éšæœºé€‰æ‹©ä¸€æ¡æ¿€åŠ±è¯­
                const randomIndex = Math.floor(Math.random() * motivationQuotes.length);
                const randomQuote = motivationQuotes[randomIndex];

                // æ›´æ–°åˆ°è¾“å…¥æ¡†
                document.getElementById('motivationText').value = randomQuote;
                motivationText = randomQuote;

                // ä¿å­˜
                saveToLocalStorage();

                // æ˜¾ç¤ºé€šçŸ¥
                showNotification('ğŸ² å·²æ¢ä¸€æ¡æ–°çš„æ¿€åŠ±è¯­ï¼');
            });

            // å‘¨æœ«å¼€å…³
            document.getElementById('showSaturday').addEventListener('change', (e) => {
                if (e.target.checked) {
                    addDay('saturday');
                } else {
                    removeDay('saturday');
                }
            });

            document.getElementById('showSunday').addEventListener('change', (e) => {
                if (e.target.checked) {
                    addDay('sunday');
                } else {
                    removeDay('sunday');
                }
            });

            document.getElementById('equalWidth').addEventListener('change', (e) => {
                const table = document.querySelector('.schedule-table');
                if (e.target.checked) {
                    table.style.tableLayout = 'fixed';
                } else {
                    table.style.tableLayout = 'auto';
                }
            });

            // å¯¼å‡ºå¤‡ä»½
            document.getElementById('exportBtn').addEventListener('click', exportData);

            // å¯¼å…¥å¤‡ä»½
            document.getElementById('importFile').addEventListener('change', importData);
        }

        function exportData() {
            const data = localStorage.getItem('scheduleData_v3');
            if (!data) {
                showNotification('âš ï¸ æ²¡æœ‰æ•°æ®å¯å¯¼å‡ºï¼');
                return;
            }
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'schedule_backup.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('ğŸ“¤ æ•°æ®å·²å¯¼å‡ºï¼');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = event.target.result;
                    const parsed = JSON.parse(data);
                    if (parsed) {
                        localStorage.setItem('scheduleData_v3', data);
                        showNotification('ğŸ“¥ æ•°æ®å·²å¯¼å…¥ï¼é¡µé¢å°†åˆ·æ–°...');
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        throw new Error();
                    }
                } catch (err) {
                    showNotification('âš ï¸ å¯¼å…¥å¤±è´¥ï¼šæ— æ•ˆçš„æ–‡ä»¶ï¼');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        function addDay(day) {
            if (!shownDays.includes(day)) {
                shownDays.push(day);
                saveToLocalStorage();
                renderSchedule();
                showNotification(`âœ… å·²æ·»åŠ ${dayMap[day]}`);
            }
        }

        function removeDay(day) {
            const index = shownDays.indexOf(day);
            if (index > -1) {
                shownDays.splice(index, 1);
                saveToLocalStorage();
                renderSchedule();
                showNotification(`ğŸ—‘ï¸ å·²åˆ é™¤${dayMap[day]}`);
            }
        }

        // è¯¾ç¨‹å›¾æ ‡åˆ—è¡¨
        const periodIcons = ['ğŸ“š', 'âœï¸', 'ğŸ“–', 'ğŸ”¬', 'ğŸ¨', 'ğŸµ', 'âš½', 'ğŸ’»', 'ğŸŒŸ', 'ğŸ“', 'ğŸ¯', 'ğŸš€'];

        // æ¸²æŸ“è¯¾ç¨‹ç®¡ç†åˆ—è¡¨
        function renderCourseManager() {
            const container = document.getElementById('courseListManager');
            if (!container) return;

            container.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹

            courseList.forEach((courseObj, index) => {
                const tag = document.createElement('div');
                tag.className = 'course-tag';
                tag.style.backgroundColor = courseObj.color;

                // è¯¾ç¨‹åç§°æ–‡æœ¬
                const textNode = document.createTextNode(courseObj.name + ' ');
                tag.appendChild(textNode);

                // é¢œè‰²é€‰æ‹©å™¨
                const colorInput = document.createElement('input');
                colorInput.type = 'color';
                colorInput.className = 'course-color-picker';
                colorInput.value = courseObj.color;
                colorInput.addEventListener('input', (e) => {
                    courseObj.color = e.target.value;
                    tag.style.backgroundColor = courseObj.color;
                    saveToLocalStorage();
                    renderSchedule();
                });
                tag.appendChild(colorInput);

                // åˆ é™¤æŒ‰é’®
                const deleteBtn = document.createElement('span');
                deleteBtn.className = 'course-delete-btn';
                deleteBtn.title = 'åˆ é™¤';
                deleteBtn.textContent = 'âœ•';

                // ç›´æ¥ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆé˜²æ­¢äº‹ä»¶å†’æ³¡é—®é¢˜ï¼‰
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // é˜»æ­¢å†’æ³¡
                    deleteCourse(index);
                });

                tag.appendChild(deleteBtn);
                container.appendChild(tag);
            });
        }

        // æ·»åŠ æ–°è¯¾ç¨‹
        function addCourse(name) {
            if (courseList.some(c => c.name === name)) {
                showNotification('âš ï¸ è¯¥è¯¾ç¨‹å·²å­˜åœ¨ï¼');
                return;
            }
            if (courseList.length >= 50) {
                showNotification('âš ï¸ è¯¾ç¨‹æ•°é‡å·²è¾¾ä¸Šé™ï¼');
                return;
            }
            // é»˜è®¤é¢œè‰²ï¼Œä½¿ç”¨éšæœºæŸ”å’Œè‰²
            const defaultColor = getRandomPastelColor();
            courseList.push({name, color: defaultColor});
            saveToLocalStorage();
            renderCourseManager();
            renderSchedule(); // æ›´æ–°é¢œè‰²
            showNotification(`âœ… å·²æ·»åŠ è¯¾ç¨‹ï¼š${name}`);
        }

        function getRandomPastelColor() {
            const hue = Math.floor(Math.random() * 360);
            return `hsl(${hue}, 70%, 90%)`;
        }

        // åˆ é™¤è¯¾ç¨‹
        function deleteCourse(index) {
            const courseName = courseList[index].name;
            openConfirmModal(`ç¡®å®šè¦åˆ é™¤è¯¾ç¨‹â€œ${courseName}â€å—ï¼Ÿ`, () => {
                courseList.splice(index, 1);
                saveToLocalStorage();
                renderCourseManager();
                renderSchedule();
                showNotification(`ğŸ—‘ï¸ å·²åˆ é™¤è¯¾ç¨‹ï¼š${courseName}`);
            });
        }

        // ç¡®è®¤å¼¹çª—é€»è¾‘
        let confirmCallback = null;

        function openConfirmModal(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            confirmCallback = callback;
            document.getElementById('confirmModalOverlay').classList.add('active');
        }

        function closeConfirmModal() {
            document.getElementById('confirmModalOverlay').classList.remove('active');
            confirmCallback = null;
        }

        // åˆå§‹åŒ–ç¡®è®¤å¼¹çª—äº‹ä»¶
        document.getElementById('confirmYesBtn').addEventListener('click', () => {
            if (confirmCallback) confirmCallback();
            closeConfirmModal();
        });

        document.getElementById('confirmNoBtn').addEventListener('click', closeConfirmModal);
        document.getElementById('confirmModalOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'confirmModalOverlay') closeConfirmModal();
        });

        // æ¸²æŸ“è¯¾ç¨‹è¡¨
        function renderSchedule() {
            const container = document.getElementById('schedulePreview');

            let html = '<table class="schedule-table">';

            // è¡¨å¤´
            html += '<thead><tr>';
            html += '<th>æ—¶é—´</th>';
            const sortedShownDays = shownDays.slice().sort((a, b) => dayOrder.indexOf(a) - dayOrder.indexOf(b));
            sortedShownDays.forEach(day => {
                html += `<th>${dayMap[day]}</th>`;
            });
            html += '</tr></thead>';

            // è¡¨ä½“
            html += '<tbody>';

            // æ ¹æ®periodCountæ¸²æŸ“æ‰€æœ‰è¯¾ç¨‹èŠ‚
            for (let i = 0; i < periodCount; i++) {
                html += '<tr>';
                // æ—¶é—´å•å…ƒæ ¼ - å¯ç‚¹å‡»
                const timeStr = getTimeDisplayStr(i);
                const periodName = periodNames[i] || `ç¬¬${i + 1}èŠ‚`;
                html += `<td class="time-cell" data-period-index="${i}"><strong>${periodName}</strong>${timeStr}</td>`;
                sortedShownDays.forEach(day => {
                    const course = scheduleData[day].courses[i] || '';
                    const cellClass = course ? 'course-cell clickable-cell' : 'empty-cell clickable-cell';
                    const displayText = course || '-';
                    const color = getCourseColor(course);
                    const style = course ? `style="background-color: ${color};"` : '';
                    html += `<td class="${cellClass}" data-day="${day}" data-index="${i}" ${style}>${displayText}</td>`;
                });
                html += '</tr>';
            }

            html += '</tbody></table>';

            // æ·»åŠ è¯¾ç¨‹èŠ‚æ•°æ§åˆ¶æŒ‰é’®
            html += `
                <div class="period-controls" style="display: flex; justify-content: center; gap: 1rem; margin-top: 1rem;">
                    <button class="btn btn-period-remove" id="removePeriodBtn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background: linear-gradient(135deg, var(--secondary-medium) 0%, var(--secondary-light) 100%); border: 2px solid var(--primary-medium); border-radius: 15px; cursor: pointer; color: var(--text-dark); font-weight: 600;">â– å‡å°‘ä¸€èŠ‚</button>
                    <span style="display: flex; align-items: center; font-weight: 600; color: var(--text-dark);">å…± ${periodCount} èŠ‚è¯¾</span>
                    <button class="btn btn-period-add" id="addPeriodBtn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background: linear-gradient(135deg, var(--primary-medium) 0%, var(--primary-dark) 100%); border: 2px solid var(--primary-medium); border-radius: 15px; cursor: pointer; color: white; font-weight: 600;">â• æ–°å¢ä¸€èŠ‚</button>
                </div>
            `;

            container.innerHTML = html;

            // æ·»åŠ å•å…ƒæ ¼ç‚¹å‡»äº‹ä»¶
            addCellClickListeners();
            // æ·»åŠ æ—¶é—´å•å…ƒæ ¼ç‚¹å‡»äº‹ä»¶
            addTimeCellClickListeners();
            // æ·»åŠ è¯¾ç¨‹èŠ‚æ•°æ§åˆ¶äº‹ä»¶
            addPeriodControlListeners();
        }

        // è·å–è¯¾ç¨‹é¢œè‰²
        function getCourseColor(course) {
            if (!course) return '';
            const courseObj = courseList.find(c => c.name === course);
            return courseObj ? courseObj.color : getRandomPastelColor();
        }

        // æ·»åŠ è¯¾ç¨‹èŠ‚æ•°æ§åˆ¶äº‹ä»¶
        function addPeriodControlListeners() {
            document.getElementById('addPeriodBtn').addEventListener('click', () => {
                if (periodCount < 15) {
                    periodCount++;
                    // ç¡®ä¿æ‰€æœ‰å¤©çš„æ•°æ®æ•°ç»„é•¿åº¦è¶³å¤Ÿ
                    for (let day in scheduleData) {
                        while (scheduleData[day].courses.length < periodCount) {
                            scheduleData[day].courses.push('');
                        }
                    }
                    // ç¡®ä¿periodTimesæ•°ç»„é•¿åº¦è¶³å¤Ÿ
                    while (periodTimes.length < periodCount) {
                        periodTimes.push({ start: '', end: '' });
                    }
                    // ç¡®ä¿periodNamesæ•°ç»„é•¿åº¦è¶³å¤Ÿ
                    while (periodNames.length < periodCount) {
                        periodNames.push(`ç¬¬${periodNames.length + 1}èŠ‚`);
                    }
                    saveToLocalStorage();
                    renderSchedule();

                    showNotification(`â• å·²æ·»åŠ ç¬¬${periodCount}èŠ‚è¯¾`);
                } else {
                    showNotification('âš ï¸ æœ€å¤šæ”¯æŒ15èŠ‚è¯¾');
                }
            });

            document.getElementById('removePeriodBtn').addEventListener('click', () => {
                if (periodCount > 1) {
                    periodCount--;
                    saveToLocalStorage();
                    renderSchedule();

                    showNotification(`â– å·²åˆ é™¤æœ€åä¸€èŠ‚è¯¾`);
                } else {
                    showNotification('âš ï¸ è‡³å°‘éœ€è¦1èŠ‚è¯¾');
                }
            });
        }

        // è·å–æ—¶é—´æ˜¾ç¤ºå­—ç¬¦ä¸²
        function getTimeDisplayStr(index) {
            const time = periodTimes[index];
            if (time && time.start && time.end) {
                return `<span class="time-display">${time.start}-${time.end}</span>`;
            }
            return '';
        }

        // æ·»åŠ æ—¶é—´å•å…ƒæ ¼ç‚¹å‡»äº‹ä»¶
        function addTimeCellClickListeners() {
            document.querySelectorAll('.time-cell').forEach(cell => {
                cell.addEventListener('click', () => {
                    const index = parseInt(cell.dataset.periodIndex);
                    openTimeModal(index);
                });
            });
        }

        // å¼¹çª—ç›¸å…³å˜é‡
        let currentEditCell = null; // å½“å‰ç¼–è¾‘çš„å•å…ƒæ ¼ä¿¡æ¯



        // æ·»åŠ å•å…ƒæ ¼ç‚¹å‡»äº‹ä»¶
        function addCellClickListeners() {
            document.querySelectorAll('.clickable-cell').forEach(cell => {
                cell.addEventListener('click', () => {
                    const day = cell.dataset.day;
                    const index = parseInt(cell.dataset.index);
                    openCourseModal(day, index);
                });
            });
        }

        // æ‰“å¼€è¯¾ç¨‹é€‰æ‹©å¼¹çª—
        function openCourseModal(day, index) {
            currentEditCell = { day, index };

            // æ›´æ–°å¼¹çª—æ ‡é¢˜ä¿¡æ¯
            document.getElementById('modalCellInfo').textContent = `${dayMap[day]} ç¬¬${index + 1}èŠ‚`;

            // ç”Ÿæˆè¯¾ç¨‹é€‰é¡¹
            const optionsContainer = document.getElementById('courseOptions');
            let optionsHTML = '';
            courseList.forEach(courseObj => {
                optionsHTML += `<div class="course-option" data-course="${courseObj.name}" style="background-color: ${courseObj.color};">${courseObj.name}</div>`;
            });
            // æ·»åŠ ä¼‘æ¯é€‰é¡¹
            optionsHTML += `<div class="course-option rest-option" data-course="ğŸ˜´ ä¼‘æ¯">ğŸ˜´ ä¼‘æ¯</div>`;
            optionsContainer.innerHTML = optionsHTML;

            // æ·»åŠ è¯¾ç¨‹é€‰é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.course-option').forEach(option => {
                // å•å‡»ï¼šå¡«å……åˆ°è¾“å…¥æ¡†
                option.addEventListener('click', () => {
                    const course = option.dataset.course;
                    document.getElementById('customCourseInput').value = course;
                });
                // åŒå‡»ï¼šç›´æ¥é€‰ä¸­å¹¶ç¡®è®¤
                option.addEventListener('dblclick', () => {
                    const course = option.dataset.course;
                    document.getElementById('customCourseInput').value = course;
                    confirmCourseSelection();
                });
            });

            // è®¾ç½®å½“å‰å€¼åˆ°è¾“å…¥æ¡†
            const currentValue = scheduleData[day].courses[index] || '';
            document.getElementById('customCourseInput').value = currentValue;

            // æ˜¾ç¤ºå¼¹çª—
            document.getElementById('courseModalOverlay').classList.add('active');

            // èšç„¦åˆ°è¾“å…¥æ¡†
            setTimeout(() => {
                document.getElementById('customCourseInput').focus();
            }, 100);
        }

        // å…³é—­è¯¾ç¨‹é€‰æ‹©å¼¹çª—
        function closeCourseModal() {
            document.getElementById('courseModalOverlay').classList.remove('active');
            currentEditCell = null;
        }

        // ç¡®è®¤è¯¾ç¨‹é€‰æ‹©
        function confirmCourseSelection() {
            if (!currentEditCell) return;

            const { day, index } = currentEditCell;
            const newCourse = document.getElementById('customCourseInput').value.trim();

            // æ›´æ–°æ•°æ®
            scheduleData[day].courses[index] = newCourse;

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveToLocalStorage();

            // é‡æ–°æ¸²æŸ“
            renderSchedule();

            // å…³é—­å¼¹çª—
            closeCourseModal();

            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('âœ… è¯¾ç¨‹å·²æ›´æ–°ï¼');
        }

        // æ¸…ç©ºå•å…ƒæ ¼
        function clearCellCourse() {
            if (!currentEditCell) return;

            const { day, index } = currentEditCell;

            // æ¸…ç©ºæ•°æ®
            scheduleData[day].courses[index] = '';

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveToLocalStorage();

            // é‡æ–°æ¸²æŸ“
            renderSchedule();

            // å…³é—­å¼¹çª—
            closeCourseModal();

            // æ˜¾ç¤ºé€šçŸ¥
            showNotification('ğŸ—‘ï¸ å·²æ¸…ç©ºè¯¥èŠ‚è¯¾ï¼');
        }

        // åˆå§‹åŒ–å¼¹çª—äº‹ä»¶
        function initModalEvents() {
            // ç¡®è®¤æŒ‰é’®
            document.getElementById('confirmCourseBtn').addEventListener('click', confirmCourseSelection);

            // æ¸…ç©ºæŒ‰é’®
            document.getElementById('clearCellBtn').addEventListener('click', clearCellCourse);

            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancelCourseBtn').addEventListener('click', closeCourseModal);

            // ç‚¹å‡»é®ç½©å±‚å…³é—­
            document.getElementById('courseModalOverlay').addEventListener('click', (e) => {
                if (e.target.id === 'courseModalOverlay') {
                    closeCourseModal();
                }
            });

            // å›è½¦ç¡®è®¤
            document.getElementById('customCourseInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    confirmCourseSelection();
                } else if (e.key === 'Escape') {
                    closeCourseModal();
                }
            });
        }

        // æ‰“å°è¯¾ç¨‹è¡¨
        function printSchedule() {
            // å¤åˆ¶è¯¾ç¨‹è¡¨åˆ°æ‰“å°åŒºåŸŸ
            const scheduleHTML = document.getElementById('schedulePreview').querySelector('.schedule-table').outerHTML;
            document.getElementById('printSchedule').innerHTML = scheduleHTML;

            // è§¦å‘æ‰“å°
            window.print();
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            const dataToSave = {
                scheduleData: scheduleData,
                motivationText: motivationText,
                ownerName: ownerName,
                currentTheme: currentTheme,
                periodTimes: periodTimes,
                periodCount: periodCount,
                courseList: courseList,
                periodNames: periodNames,
                shownDays: shownDays
            };
            localStorage.setItem('scheduleData_v3', JSON.stringify(dataToSave));
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
        function loadFromLocalStorage() {
            // å°è¯•åŠ è½½v3ç‰ˆæ•°æ®
            let saved = localStorage.getItem('scheduleData_v3');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    if (parsed.scheduleData) {
                        // åˆå¹¶è¯¾ç¨‹æ•°æ®
                        for (let day in parsed.scheduleData) {
                            if (scheduleData[day] && parsed.scheduleData[day].courses) {
                                scheduleData[day].courses = parsed.scheduleData[day].courses;
                            }
                        }
                    }
                    motivationText = parsed.motivationText || 'å­¦ä¹ å¾ˆè‹¦,åšæŒå¾ˆé…·';
                    ownerName = parsed.ownerName;
                    currentTheme = parsed.currentTheme || 'sakura';
                    periodCount = parsed.periodCount || 8;
                    if (parsed.periodTimes) {
                        periodTimes = parsed.periodTimes;
                    }
                    if (parsed.periodNames) {
                        periodNames = parsed.periodNames;
                    }
                    if (parsed.courseList && Array.isArray(parsed.courseList)) {
                        courseList = parsed.courseList.map(c => {
                            if (typeof c === 'string') {
                                return {name: c, color: getRandomPastelColor()};
                            } else {
                                return c;
                            }
                        });
                    }
                    if (parsed.shownDays && Array.isArray(parsed.shownDays)) {
                        shownDays = parsed.shownDays;
                    }
                    document.getElementById('motivationText').value = motivationText;
                } catch (e) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
                }
                return;
            }

            // å…¼å®¹v2ç‰ˆæœ¬æ•°æ®
            saved = localStorage.getItem('scheduleData_v2');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    motivationText = parsed.motivationText || 'å­¦ä¹ å¾ˆè‹¦,åšæŒå¾ˆé…·';
                    ownerName = parsed.ownerName;
                    currentTheme = parsed.currentTheme || 'sakura';
                    if (parsed.periodTimes) {
                        periodTimes = parsed.periodTimes;
                    }
                    // å°è¯•è¿ç§»æ—§æ•°æ®æ ¼å¼
                    if (parsed.scheduleData) {
                        for (let day in parsed.scheduleData) {
                            const oldData = parsed.scheduleData[day];
                            if (oldData.morning && oldData.afternoon) {
                                scheduleData[day].courses = [...oldData.morning, ...oldData.afternoon];
                            } else if (oldData.courses) {
                                scheduleData[day].courses = oldData.courses;
                            }
                        }
                    }
                    document.getElementById('motivationText').value = motivationText;
                } catch (e) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
                }
                return;
            }

            // å…¼å®¹æœ€æ—§ç‰ˆæœ¬æ•°æ®
            saved = localStorage.getItem('scheduleData_mengzhongqi');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    if (parsed.scheduleData) {
                        for (let day in parsed.scheduleData) {
                            const oldData = parsed.scheduleData[day];
                            if (oldData.morning && oldData.afternoon) {
                                scheduleData[day].courses = [...oldData.morning, ...oldData.afternoon];
                            }
                        }
                        motivationText = parsed.motivationText || 'å­¦ä¹ å¾ˆè‹¦,åšæŒå¾ˆé…·';
                    }
                    document.getElementById('motivationText').value = motivationText;
                } catch (e) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
                }
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.className = 'notification-toast';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-medium) 100%);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 20px;
                box-shadow: var(--shadow);
                z-index: 10000;
                font-weight: 700;
                animation: slideInRight 0.3s ease;
                border: 2px solid white;
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // ========== åå­—ç¼–è¾‘åŠŸèƒ½ ==========
        function showNameEdit() {
            document.getElementById('ownerNameDisplay').style.display = 'none';
            document.getElementById('nameInputContainer').classList.add('active');
            const input = document.getElementById('nameInput');
            input.value = ownerName;
            input.focus();
            input.select();
        }

        function confirmNameEdit() {
            const input = document.getElementById('nameInput');
            const newName = input.value.trim();
            if (newName) {
                ownerName = newName;
                updateOwnerNameDisplay();
                saveToLocalStorage();
                showNotification('âœ… åå­—å·²æ›´æ–°ï¼');
            }
            document.getElementById('nameInputContainer').classList.remove('active');
            document.getElementById('ownerNameDisplay').style.display = 'flex';
        }

        function updateOwnerNameDisplay() {
            const theme = themeDecorations[currentTheme];
            document.getElementById('ownerNameText').textContent = ownerName;
            document.getElementById('ownerIcon').textContent = theme.icon;
            document.getElementById('ownerDecor').textContent = theme.decor;
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = `${ownerName}çš„è¯¾ç¨‹è¡¨ ğŸ¦‹`;
        }

        // åå­—è¾“å…¥æ¡†çš„é”®ç›˜äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('nameInput').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    confirmNameEdit();
                } else if (e.key === 'Escape') {
                    document.getElementById('nameInputContainer').classList.remove('active');
                    document.getElementById('ownerNameDisplay').style.display = 'flex';
                }
            });
        });

        // ========== ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ ==========
        function initThemeEvents() {
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    applyTheme(theme);
                    saveToLocalStorage();
                    showNotification('ğŸ¨ ä¸»é¢˜å·²åˆ‡æ¢ï¼');
                });
            });
        }

        function applyTheme(theme) {
            currentTheme = theme;
            // è®¾ç½®ä¸»é¢˜
            document.body.setAttribute('data-theme', theme);
            // æ›´æ–°ä¸»é¢˜æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
            // æ›´æ–°è£…é¥°å…ƒç´ 
            updateDecorations();
            // æ›´æ–°åå­—æ˜¾ç¤º
            updateOwnerNameDisplay();
        }

        function updateDecorations() {
            const theme = themeDecorations[currentTheme];
            const decorations = document.querySelectorAll('.decoration');
            decorations.forEach((dec, index) => {
                const itemIndex = index % theme.items.length;
                dec.textContent = theme.items[itemIndex];
            });
        }

        // ========== æ—¶é—´ç¼–è¾‘åŠŸèƒ½ ==========
        function initTimeModalEvents() {
            document.getElementById('confirmTimeBtn').addEventListener('click', confirmTimeEdit);
            document.getElementById('clearTimeBtn').addEventListener('click', clearTimeEdit);
            document.getElementById('cancelTimeBtn').addEventListener('click', closeTimeModal);

            document.getElementById('timeModalOverlay').addEventListener('click', (e) => {
                if (e.target.id === 'timeModalOverlay') {
                    closeTimeModal();
                }
            });
        }

        function openTimeModal(index) {
            currentTimeIndex = index;
            document.getElementById('timePeriodInfo').textContent = periodNames[index] || `ç¬¬${index + 1}èŠ‚`;

            const time = periodTimes[index];
            document.getElementById('timeStart').value = time.start || '08:00';
            document.getElementById('timeEnd').value = time.end || '08:45';
            document.getElementById('periodNameInput').value = periodNames[index] || `ç¬¬${index + 1}èŠ‚`;

            document.getElementById('timeModalOverlay').classList.add('active');
        }

        function closeTimeModal() {
            document.getElementById('timeModalOverlay').classList.remove('active');
            currentTimeIndex = -1;
        }

        function confirmTimeEdit() {
            if (currentTimeIndex < 0) return;

            const startTime = document.getElementById('timeStart').value;
            const endTime = document.getElementById('timeEnd').value;
            const periodName = document.getElementById('periodNameInput').value.trim() || `ç¬¬${currentTimeIndex + 1}èŠ‚`;

            periodTimes[currentTimeIndex] = { start: startTime, end: endTime };
            periodNames[currentTimeIndex] = periodName;
            saveToLocalStorage();
            renderSchedule();
            closeTimeModal();
            showNotification('â° æ—¶é—´å·²è®¾ç½®ï¼');
        }

        function clearTimeEdit() {
            if (currentTimeIndex < 0) return;

            periodTimes[currentTimeIndex] = { start: '', end: '' };
            periodNames[currentTimeIndex] = `ç¬¬${currentTimeIndex + 1}èŠ‚`;
            saveToLocalStorage();
            renderSchedule();
            closeTimeModal();
            showNotification('ğŸ—‘ï¸ æ—¶é—´å·²æ¸…ç©ºï¼');
        }
    </script>
</body>

</html>